# Симуляция склада с WHCA алгоритмом
Данный проект берет за основу симуляцию кслада на c# реализованную @afanasenko-taras и применяет алгоритм WHCA для управления роботоми. Целью 

## Описание системы
Система склада представляет собой двумерную карту с клетчатой квадратной разметкой. Посылки помещаются работниками на ленты, сканируются и поступают на точки погрузки - входы. У каждой из посылок есть направление, отвечающее хотя бы одной точке сброса на карте, то есть их может быть и несколько. Также на карте есть клетки с зарядным устройством к робот может подключаться если он находится в соседней клетке и перпендикулярно направлен относительно зарядного устройства.

## Описание входных конфигураций
На вход модели подается конфигурация в XML формате (пример - run_0/wms-config.xml) со всеми основными параметрами, включая путь к конфигурациям карты, события посылок и начальное положения роботов.

Название параметра  | Смысл параметра
------------- | -------------
zoneSize | размер одной зоны в метрах
unitSize | размер одного робота физический
safeUnitSize | размер зоны робота в которую нельзя заезжать другим роботам
unitSpeed | Скорость робота в метрах в секунду
unitAccelerationTime | Время набора скорости юнита от 0 до UnitSpeed
unitStopTime | Время остановки юнита с UnitSpeed до 0
unitRotateTime | Время разворота юнита на 90 градусов
unitAccelerationEnergy | Стоимость разгона для расчета метрики
unitStopEnergy | Энергия на остановку
unitMoveEnergy | Энергия на 1 секунду движения
unitRotateEnergy | Энергия на разворот
loadTime | Время погрузки
unloadTime | Время разгрузки
unitLoadEnergy | Энергия на загрузку
unitUnloadEnergy | Энергия на разгрузку
unitWaitEnergy | Энергия на одну секунду ожидания
unitChargeTime | Время полной зарядки в секундах
unitChargeValue | Объем зарядки одного робота
skladLayout | путь к конфигурации карты относительно `\model\TestSklad2\bin\Release\netcoreapp3.1\TestSklad2.exe`
antBotLayout | путь к конфигурации роботов относительно `\model\TestSklad2\bin\Release\netcoreapp3.1\TestSklad2.exe`
incomeLayout | путь к конфигурации посылок относительно `\model\TestSklad2\bin\Release\netcoreapp3.1\TestSklad2.exe`

Файл карты имеет CSV формат и включает в себе перечисление типов клеток в виде целых чисел через запятую с пробелом и переносы строки. Чтобы задать в каком положении робот должен находиться на специфических клетках, каждый такой тип задается двумя числами в зависимости от направления. Будем условно называть положение вдоль оси X горизонтальным, а Y – вертикальным. Типы клеток задаются следующим образом: 0 – стена; 1 – свободная клетка; 2 – вход на котором необходимо находиться в горизонтальном положении; 3 – горизонтально направленный выход; 4 – горизонтально направленное зарядное устройство; 5 – вход на котором необходимо находиться в вертикальном положении; 6 – вертикально направленный выход; 7 – вертикально направленное зарядное устройство. Пример карты - run_0/W3.csv

Файл конфигурации роботов имеет CSV формат и включает в себе перечисление начальных положений роботов на карте. Каждый робот задается парой чисел – координаты по X и Y, предполагается, что изначально все роботы в горизонтальном положении (оси направлены от левого верхнего угла и нумерация начинается с 0). Пример конфигурации роботов - run_0/wms-robots_1.csv

В условиях симуляции пока реализована упрощенная система и посылки генерируются случайным образом каждый раз когда робот подъезжает к входу.

Программа ведет логирование создавая два выходных файла – log.xml и log_unity.xml. Эти файлы используются визуализатором. Путь к ним указан в коде Main файла Program.cs. Там же указывается путь к главному файлу конфигурации.

## Настройка и запуск

Requirements:
1. `git clone git@github.com:klyuchnikova/PostSimulation.git`
2. `git checkout control_attempt`
3. Убедитесь что у вас есть .NET 3.1 
4. В коде model\TestSklad2\Program.cs укажите нужные пути до входной кофигурации и путей для логирования и другие параметры
5. Постройте и запустите решение TestSklad2